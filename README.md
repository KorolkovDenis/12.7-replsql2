### Домашнее задание к занятию «Репликация и масштабирование. Часть 2» - Корольков Денис

### Задание 1

Опишите основные преимущества использования масштабирования методами:

- активный master-сервер и пассивный репликационный slave-сервер; 
- master-сервер и несколько slave-серверов;
- активный сервер со специальным механизмом репликации — distributed replicated block device (DRBD);
- SAN-кластер.

*Дайте ответ в свободной форме.*

Ответ:

Активный master-сервер и пассивный репликационный slave-сервер;

В этом подходе выделяется один основной сервер базы данных, который называется Мастером. На нем происходят все изменения в данных (любые запросы INSERT/UPDATE/DELETE). Слейв сервер постоянно копирует все изменения с Мастера. С приложения на Слейв сервер отправляются запросы чтения данных (запросы SELECT). Таким образом Мастер сервер отвечает за изменения данных, а Слейв за чтение.
В случае падения мастера-сервера можно быстро переключиться на slave (на котором хранится реплика). В случае синхронной реплики, мы полностью сохраним наши данные, в случае асинхронной - потеряем незначительное их количество. Синхронная или асинхронная реплика зависит от критичности данных для проекта, критично ли потерять данный за небольшой промежуток времени или нет.

master-сервер и несколько slave-серверов;

Преимущество этого типа репликации в том, что Вы можете использовать более одного Слейва. Обычно следует использовать не более 20 Слейв серверов при работе с одним Мастером. Например при использовании одного мастера и двух реплик – одна реплика – асинхронная, вторая реплика – синхронная. И при выходе из строя мастера, переходим на синхронную реплику – и все будет работать в штатном режиме, без потери данных. (повышенная отказоустойчивость). Также наличие slave-реплик помогает разгружать мастер-сервер – мастер-сервер работает на запись остальные slave работают для отработки запросов чтения данных (select) через балансировщик.

Активный сервер со специальным механизмом репликации — distributed replicated block device (DRBD);

DRBD - это распределенная система хранения на уровне хранения ядра Linux. DRBD может использоваться для совместного использования блочных устройств, файловых систем и данных между двумя серверами Linux. Аналогично функции сетевого RAID-1.
Использование функции DRBD в режиме высокой доступности (HA) может заменить использование общего дискового массива. Данные локального (первичный узел) и удаленного хоста (резервный узел) могут быть синхронизированы во время проверки. Когда локальная система выходит из строя, на удаленном хосте будет копия тех же данных, которые можно будет использовать постоянно.
DRBD дает дополнительное преимущество в увеличении отказоустойчивости.

SAN-кластер

В контексте технологии SAN, Кластеризация серверов подразумевает объединение нескольких серверов с целью увеличения производительности и/или надежности.
Существует несколько преимуществ кластеризации внутри SAN. Среди них: 
разделяемый доступ к дискам и ленточным устройствам,
большая производительность репликации данных, 
лучшая масштабируемость дисковой системы 
расширенная отказоустойчивость, наследующая все преимущества основанных на SAN систем хранения данных.


### Задание 2

Разработайте план для выполнения горизонтального и вертикального шаринга базы данных. База данных состоит из трёх таблиц: 

- пользователи, 
- книги, 
- магазины (столбцы произвольно). 

Опишите принципы построения системы и их разграничение или разбивку между базами данных.

*Пришлите блоксхему, где и что будет располагаться. Опишите, в каких режимах будут работать сервера.* 

Ответ:

Data sharding — механическое разделение огромных объемов однотипных данных на несколько частей (shard — шардинг). С точки зрения реализации, это наиболее трудоемкий вариант.

Шардинг (иногда шардирование) — это техника масштабирования при работе с данными. Его суть в разделении (партиционирование) базы данных на отдельные части так, чтобы каждую из них можно было вынести на отдельный сервер.

Существует два вида шардинга:
```
● вертикальный;
● горизонтальный.
```
Вертикальный шардинг — это выделение таблицы или группы таблиц на отдельный сервер.
Для каждой таблицы или группы таблиц будет отдельное соединение.

![screen1](https://github.com/KorolkovDenis/12.7-replsql2/blob/main/screenshots/screen1.jpg)

Горизонтальный шардинг — это разделение одной таблицы на разные сервера. Это необходимо использовать для огромных таблиц, которые не умещаются на одном сервере.

Разделение таблицы на части делается по следующему принципу:
```
● на нескольких серверах создается одна и та же таблица (только структура, без данных);
● в приложении выбирается условие, по которому будет определяться нужное соединение (например, четные на один сервер, а нечетные — на другой);
● перед каждым обращением к таблице происходит выбор нужного соединения.
```
таблица Books была разделена на 2 сервера по названию книги от A-N и от O-Z
таблица Users также разделена на 2 сервера по принципу аутентификации и данных users
таблица Stores была перенесена полностью в отдельный сервер без изменений

![screen2](https://github.com/KorolkovDenis/12.7-replsql2/blob/main/screenshots/screen2.jpg)

## Дополнительные задания (со звёздочкой*)
Эти задания дополнительные, то есть не обязательные к выполнению, и никак не повлияют на получение вами зачёта по этому домашнему заданию. Вы можете их выполнить, если хотите глубже шире разобраться в материале.

---
### Задание 3*

Выполните настройку выбранных методов шардинга из задания 2.

*Пришлите конфиг Docker и SQL скрипт с командами для базы данных*.
